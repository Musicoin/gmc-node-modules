language: node_js
os: linux
node_js: 8.0.0
yarn: 1.7.0
services:
- docker
before_script:
jobs:
  include:
  - stage: Github Release
    go: 1.10.0
    node: 8.0.0
    yarn: 1.7.0
      before_script:
      - git branch -d staging
      script:
      - echo "Building Go-Musicoin v1.0.0-${TRAVIS_BUILD_NUMBER}"
      - rm -rf bin
      - "./index.sh"
      - mv ./go-musicoin/build/bin .
      - rm -rf go-musicoin
      after_success:
      - git config credential.helper "store --file=.git/credentials"
      - echo "https://${GH_TOKEN}:@github.com" > .git/credentials
      - git checkout -b staging
      - git add -A
      - git commit -am "${TRAVIS_BUILD_NUMBER}"
      - git push origin staging --force --tags
  - stage: "Pushback"
    deploy:
      provider: releases
      skip_cleanup: true
      after_success:
      - git tag -d $(git tag)
      - git tag "v1.0.0-${TRAVIS_BUILD_NUMBER}"
      - git branch -d release
      - git checkout -b release
      - git push origin --all
      on:
        branches:
          only: staging
  - stage: Yarn/NPM Release
    node_js: 8.0.0
    script:
    - echo "Creating NPM Release ..."
    deploy:
      provider: npm
      email: parker.casey@gmail.com
      on:
        branches:
          tags: true
          only: release
      api_key:
        secure: QGstEAVTetstdmoqKhDoabLnlj5BYGlgfBBIpi2VLGSmAfIABYpPUWP9U9O4rwDwURE5LFYfO9zsn3sDgwqkTevXX3JVISdZsUAXPhXcEuWN5AUhqJtDAdTYXo3cPA0XE6fDIbZvJ4cGRMSZ8yxwQ/tkMSjd2M8HP5GfQB4JbAUrGmBstwlhz8PqMnCCOehBUrTOFJEBXitF6vBsFHlgZ6BVH/+tV1cxZHGj02iInBjJxIHO+oTWZB5tIW4sfpueYxWfpWGuxam5JOd+CFWM7Nb94h4WpBTglFEfanR8lslNV8XjaIgoqjByEZsRZCMeSWh1iSxUNMTr2tFbKop4eTGlQ8iUJvWpwbxncrdR1BQcRpT+CusN3ZWUnb8Vp/0YpkVb490tIfh6ZL4oY5JvpZRrD/4TjJID5jXOFLNuj+E00jXaQD8fksmaE7rTEujjBZ/dg5eWQTlbgFVDjIbLs9H87U805SG9yf3iBjf7OMxUPfzAr4fI4SREJUQcVN5uIIJUv/Eo0dJCIpJjwHGvQl5e9shdZ4FCwTFOkYp3udb93GvBnWdMubxWzmc8+jPspTAu337qqUDIAtXbdfUG7xg1L+xZ75Tc383XbazH84AkFsEWqu5OcEgO0CY7KRjQB1svoaM3vXBt6gBnyyO0b4kQJ1zMkAgofCyyMeZ8lmw=
env:
  global:
    secure: ICczZd8IZHgAI6QKe3wMX+GkpfCWf5+ytbqilcrsmVNrnWzVjhTPd0+66lFDp0Nc9AHNDh0l8PBB0TCuJj47XVEY+qy5PO6SIscYW8inYe9KVfJn9lDvQxmsKdtIpWNmbIQJtHcbP3D8/Cni5DYNHU1cOYkRqRUC/imVOgTD9J8Z6MJU5TMv8VAdGCG5PobhgDQyanh7AWcms44Mu2/tw6BQjKbdMJbaR7B0JPz/6L1eUsdz8A6Kvo54pVlo+OKRfPuWe4ZWJ6+42z72zj2Krth2jlchI97aJKoivundV/W+8zMy+krf7SwQeSGydyTJOgo2VzJXQxHsB/uk+xFQhszl+K4KzbGDrLYSORYMpqEgjtuuAJ82v9/EW405iqKBdsPsb3ZX+Ic+clRAEjdHjAQv/Jprvxv/xBI4PpgR774HxOVsQf/OwpUGaZ7Gln0/K/WDqn+G0kZGYSXAcbsqW3c6F7/mzYSZq9mYX+Xrrpw4O68K+otbFMA+ToBGETmS/wOrBHy4SVVdt1Dha6HUUE7ytmbRgUwFcKbbflXpMixB6p2RBt2WfAVxYeo6/DzaOeHtWWCYoEOa/AZUB3jNwB46g7txaoviwltccF/EI2Lev15+yTU8Gxz9fhXdw4wEAhS73ryxgXGhKbWEz5bAGcOiRpoQx//4ICVm6GUsSKI=
